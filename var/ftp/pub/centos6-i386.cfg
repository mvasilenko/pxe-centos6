#platform=x86
#, AMD64, or Intel EM64T
#version=DEVEL
# Firewall configuration
firewall --disabled
# Install OS instead of upgrade
install
# Use FTP installation media
url --url="ftp://192.168.1.91/pub/"
# Root password
rootpw --iscrypted $1$xxx
# System authorization information
auth useshadow passalgo=sha512
# Use graphical install
#graphical
text
#firstboot disable
# System keyboard
keyboard us
# System language
lang en_US
# SELinux configuration
selinux disabled
selinux --disabled
# Installation logging level
logging level=info
# System timezone
timezone Europe/Kiev
# System bootloader configuration
bootloader location=mbr
zerombr
reboot
clearpart --all --initlabel
#autopart
reboot 
part /boot --fstype=ext4 --size=512
part swap --size=1024
part / --fstype=ext4 --size=40768 --grow

%packages --nobase

@core

%post
cat > post-install.sh << 'EOF'
#!/bin/bash -v
FTP="ftp://192.168.1.91/pub/local"
yum -y install epel-release
yum -y upgrade 
yum -y groupinstall "Development tools"
yum -y install net-snmp mc wget openvpn telnet lftp ftp vim 

cat /dev/zero | ssh-keygen -q -N "" > /dev/null
wget -O /root/.ssh/authorized_keys $FTP/authorized_keys
chmod 600 /root/.ssh/authorized_keys

 
wget -O /etc/sysconfig/network-scripts/ifcfg-eth0 $FTP/ifcfg-eth0
wget -O /etc/sysconfig/network-scripts/ifcfg-eth0:0 $FTP/ifcfg-eth0:0
wget -O /etc/sysconfig/network-scripts/ifcfg-eth1 $FTP/ifcfg-eth1
wget -O /etc/sysconfig/network $FTP/network
wget -O /etc/sysconfig/iptables $FTP/iptables

cd /etc/openvpn && rm -f * && wget $FTP/openvpn/*
chkconfig --level 3 openvpn on
chmod 600 /etc/openvpn/*.key

wget -O /etc/snmp/snmpd.conf $FTP/snmpd.conf
wget -O /etc/sysconfig/snmpd $FTP/snmpd
 
wget -O /mvts.tar.gz $FTP/mvts.tar.gz
cd / && tar zxvf mvts.tar.gz

EOF

chmod 0755 post-install.sh
(./post-install.sh) > post-install.log 2>&1

%end
